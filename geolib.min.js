/**
 * A small library to provide some basic geo functions like distance calculation,
 * conversion of decimal coordinates to sexagesimal and vice versa, etc.
 * 
 * @author Manuel Bieh
 * @url http://www.manuel-bieh.de/
 * @version 1.1.0
 * @license http://www.gnu.org/licenses/lgpl-3.0.txt LGPL
 *
 */
(function(){var a=6378137;var b=/^([0-9]{1,3})°\s*([0-9]{1,3})'\s*(([0-9]{1,3}(\.([0-9]{1,2}))?)"\s*)?([NEOSW]?)$/;var c={decimal:{},sexagesimal:{},distance:0,getDistance:function(b,d,e){e=parseInt(e)||1;var f={},g={};f.latitude=c.useDecimal(b.latitude)/180*Math.PI;f.longitude=c.useDecimal(b.longitude)/180*Math.PI;g.latitude=c.useDecimal(d.latitude)/180*Math.PI;g.longitude=c.useDecimal(d.longitude)/180*Math.PI;var h=Math.round(Math.acos(Math.sin(g.latitude)*Math.sin(f.latitude)+Math.cos(g.latitude)*Math.cos(f.latitude)*Math.cos(f.longitude-g.longitude))*a);return c.distance=parseInt(Math.round(h/e)*e)},getCenter:function(a){max=function(a){return Math.max.apply(Math,a)};min=function(a){return Math.min.apply(Math,a)};var b,d,e={lat:[],lng:[]};for(coord in a){e.lat.push(c.useDecimal(a[coord].latitude));e.lng.push(c.useDecimal(a[coord].longitude))}var f=min(e.lat);var g=min(e.lng);var h=max(e.lat);var i=max(e.lng);b=((f+h)/2).toFixed(6);d=((g+i)/2).toFixed(6);var j=c.convertUnit("km",c.getDistance(f,g,h,i));return{latitude:b,longitude:d,distance:j}},isPointInside:function(a,b){for(var c=false,d=-1,e=b.length,f=e-1;++d<e;f=d){(b[d].longitude<=a.longitude&&a.longitude<b[f].longitude||b[f].longitude<=a.longitude&&a.longitude<b[d].longitude)&&a.latitude<(b[f].latitude-b[d].latitude)*(a.longitude-b[d].longitude)/(b[f].longitude-b[d].longitude)+b[d].latitude&&(c=!c)}return c},orderByDistance:function(a,b){var d=[];for(coord in b){var e=c.getDistance(a,b[coord]);d.push({key:coord,latitude:b[coord].latitude,longitude:b[coord].longitude,distance:e})}return d.sort(function(a,b){return a.distance-b.distance})},findNearest:function(a,b,d){d=d||0;var e=c.orderByDistance(a,b);return e[d]},convertUnit:function(a,b,d){if(b==0||typeof b=="undefined"){if(c.distance==0){return 0}else{b=c.distance}}a=a||"m";d=d||4;switch(a){case"m":return c.round(b,d);break;case"km":return c.round(b/1e3,d);break;case"cm":return c.round(b*100,d);break;case"mm":return c.round(b*1e3,d);break;case"mi":return c.round(b*(1/1609.344),d);break;case"sm":return c.round(b*(1/1852.216),d);break;case"ft":return c.round(b*(100/30.48),d);break;case"in":return c.round(b*100/2.54,d);break;case"yd":return c.round(b*(1/.9144),d);break}return b},useDecimal:function(a){a=a.toString().replace(/\s*/,"");if(!isNaN(parseFloat(a))&&parseFloat(a).toString()==a){return a}else if(c.isSexagesimal(a)==true){return c.sexagesimal2decimal(a)}else{throw"Unknown format."}},decimal2sexagesimal:function(a){tmp=a.toString().split(".");var b=tmp[0];var d=("0."+tmp[1])*60;var e=d.toString().split(".");d=parseInt(d);e=(("0."+e[1])*60).toFixed(2);c.sexagesimal[a]=b+"° "+d+"' "+e+'"';return c.sexagesimal[a]},sexagesimal2decimal:function(a){var d=new RegExp(b);var e=d.exec(a);if(!!e){var f=parseFloat(e[2]/60);var g=parseFloat(e[4]/3600)||0}var h=(parseFloat(e[1])+f+g).toFixed(8);h=e[7]=="S"||e[7]=="W"?h*-1:h;c.decimal[a]=h;return h},isSexagesimal:function(a){return b.test(a)},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}};window.geolib=c})()