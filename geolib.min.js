/**
 * A small library to provide some basic geo functions like distance calculation,
 * conversion of decimal coordinates to sexagesimal and vice versa, etc.
 * 
 * @author Manuel Bieh
 * @url http://www.manuel-bieh.de/
 * @version 1.1.1
 * @license http://www.gnu.org/licenses/lgpl-3.0.txt LGPL
 *
 */
(function(a,b){var c=6378137;var d=/^([0-9]{1,3})°\s*([0-9]{1,3})'\s*(([0-9]{1,3}(\.([0-9]{1,2}))?)"\s*)?([NEOSW]?)$/;var e={decimal:{},sexagesimal:{},distance:0,getDistance:function(a,b,d){d=parseInt(d)||1;var f={},g={};f.latitude=e.useDecimal(a.latitude)/180*Math.PI;f.longitude=e.useDecimal(a.longitude)/180*Math.PI;g.latitude=e.useDecimal(b.latitude)/180*Math.PI;g.longitude=e.useDecimal(b.longitude)/180*Math.PI;var h=Math.round(Math.acos(Math.sin(g.latitude)*Math.sin(f.latitude)+Math.cos(g.latitude)*Math.cos(f.latitude)*Math.cos(f.longitude-g.longitude))*c);return e.distance=parseInt(Math.round(h/d)*d)},getCenter:function(a){max=function(a){return Math.max.apply(Math,a)};min=function(a){return Math.min.apply(Math,a)};var b,c,d={lat:[],lng:[]};for(coord in a){d.lat.push(e.useDecimal(a[coord].latitude));d.lng.push(e.useDecimal(a[coord].longitude))}var f=min(d.lat);var g=min(d.lng);var h=max(d.lat);var i=max(d.lng);b=((f+h)/2).toFixed(6);c=((g+i)/2).toFixed(6);var j=e.convertUnit("km",e.getDistance(f,g,h,i));return{latitude:b,longitude:c,distance:j}},isPointInside:function(a,b){for(var c=false,d=-1,e=b.length,f=e-1;++d<e;f=d){(b[d].longitude<=a.longitude&&a.longitude<b[f].longitude||b[f].longitude<=a.longitude&&a.longitude<b[d].longitude)&&a.latitude<(b[f].latitude-b[d].latitude)*(a.longitude-b[d].longitude)/(b[f].longitude-b[d].longitude)+b[d].latitude&&(c=!c)}return c},orderByDistance:function(a,b){var c=[];for(coord in b){var d=e.getDistance(a,b[coord]);c.push({key:coord,latitude:b[coord].latitude,longitude:b[coord].longitude,distance:d})}return c.sort(function(a,b){return a.distance-b.distance})},findNearest:function(a,b,c){c=c||0;var d=e.orderByDistance(a,b);return d[c]},getPathLength:function(a){var b=0,c;for(coord in a){if(c){b+=e.getDistance(a[coord],c)}c=a[coord]}return b},convertUnit:function(a,b,c){if(b==0||typeof b=="undefined"){if(e.distance==0){return 0}else{b=e.distance}}a=a||"m";c=c||4;switch(a){case"m":return e.round(b,c);break;case"km":return e.round(b/1e3,c);break;case"cm":return e.round(b*100,c);break;case"mm":return e.round(b*1e3,c);break;case"mi":return e.round(b*(1/1609.344),c);break;case"sm":return e.round(b*(1/1852.216),c);break;case"ft":return e.round(b*(100/30.48),c);break;case"in":return e.round(b*100/2.54,c);break;case"yd":return e.round(b*(1/.9144),c);break}return b},useDecimal:function(a){a=a.toString().replace(/\s*/,"");if(!isNaN(parseFloat(a))&&parseFloat(a).toString()==a){return a}else if(e.isSexagesimal(a)==true){return e.sexagesimal2decimal(a)}else{throw"Unknown format."}},decimal2sexagesimal:function(a){tmp=a.toString().split(".");var b=tmp[0];var c=("0."+tmp[1])*60;var d=c.toString().split(".");c=parseInt(c);d=(("0."+d[1])*60).toFixed(2);e.sexagesimal[a]=b+"° "+c+"' "+d+'"';return e.sexagesimal[a]},sexagesimal2decimal:function(a){var b=new RegExp(d);var c=b.exec(a);if(!!c){var f=parseFloat(c[2]/60);var g=parseFloat(c[4]/3600)||0}var h=(parseFloat(c[1])+f+g).toFixed(8);h=c[7]=="S"||c[7]=="W"?h*-1:h;e.decimal[a]=h;return h},isSexagesimal:function(a){return d.test(a)},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}};a.geolib=e})(this)